extends _partials/_layout.pug

block content
  link(rel="stylesheet" href="css/profile.css")

  .jumbotron= user.email
    .tasks #{tasks.filter(function(t){return t.completed}).length} / #{tasks.length}
      .progress-container
        .progress-bar

  .container
    .row
      .col-xs-12.col-md-6
        form#newTask( action="/tasks/create", method="post")
              .input-group
                input(type="text", placeholder="Add Task", name="text", autofocus="true").form-control
                span.input-group-btn
                  input(type="submit" value="+").btn.btn-success
    .row
      .col-xs-12
        each day, dayIndex in ['M', 'T', 'W', 'TH', 'F', 'SAT', 'SUN']
          .col-sm-2.col-xs-12
              .text-center=day
              .card-holder(ondrop="dropContent(event)", ondragover="allowDrop(event)", data-column-id=dayIndex)
                each task, index in tasks
                  if task.day === dayIndex
                    if !(task.completed)
                      .card(ondragstart="dragStart(event)", draggable="true", data-info=index, data-id=task.id)
                        .card-text= task.text
                        form(action="/tasks/edit/" + task.id, method="post")
                          button.card-success(type="submit") &#10004;
                          input(type="hidden", name="text", value=task.text)
                          input(type="checkbox", name="completed", style="display:none")
                        a(href="/tasks/edit/" + task.id)
                          button.card-primary  &#9998;
                        form(action="/tasks/delete/" + task.id, method="post")
                          button.card-danger(type="submit") &#10006;
                    else
                      .card.complete(ondragstart="dragStart(event)", draggable="true", data-info=index, data-id=task.id)
                        .card-text= task.text
                        form(action="/tasks/edit/" + task.id, method="post")
                          button.card-success(type="submit") &#10004;
                          input(type="hidden", name="text", value=task.text)
                          input(type="checkbox", name="completed", checked, style="display:none")
                        a(href="/tasks/edit/" + task.id)
                          button.card-primary  &#9998;
                        form(action="/tasks/delete/" + task.id, method="post")
                          button.card-danger(type="submit") &#10006;

  script.

    // progress bar logic
    setTimeout(function() {
      var progBar = document.querySelector('.progress-bar')

      var setWidth = #{tasks.filter(function(t){return t.completed}).length} / #{tasks.length};
      progBar.style.width = '' + (setWidth * 100) + '%'

      var targetHue = (setWidth * 100) * 1.2


      //- console.log(setWidth)
      //- console.log('targetHue', targetHue)
      progBar.style.backgroundColor = "hsla( " + targetHue + ", 100%, 50%, 1)";
      //- console.log('background:', progBar.style.backgroundColor)
    }, 0)


  script(src="js/dropLogic.js")
